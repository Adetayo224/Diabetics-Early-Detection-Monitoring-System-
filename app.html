<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diamon - Smart Footwear Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
        }

        .hidden {
            display: none !important;
        }

        /* Login View */
        #loginView {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #e63946 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-container {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 400px;
            width: 100%;
        }

        .login-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .login-header h1 {
            color: #1e3c72;
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .login-header p {
            color: #666;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #333;
            font-weight: 600;
        }

        .form-group input {
            width: 100%;
            padding: 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
        }

        .form-group input:focus {
            outline: none;
            border-color: #1e3c72;
        }

        .btn-login {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .btn-login:hover {
            transform: translateY(-2px);
        }

        .demo-accounts {
            margin-top: 1.5rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.85rem;
            color: #666;
        }

        /* Hospital Picker */
        #pickerView {
            min-height: 100vh;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .picker-container {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 500px;
            width: 100%;
        }

        select {
            width: 100%;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1rem;
            margin-bottom: 1rem;
        }

        /* Main App */
        #appView {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: linear-gradient(180deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 2rem 0;
            position: fixed;
            height: 100vh;
            overflow-y: auto;
        }

        .sidebar-header {
            padding: 0 1.5rem;
            margin-bottom: 2rem;
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        .role-badge {
            background: rgba(255,255,255,0.2);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.85rem;
            display: inline-block;
        }

        .menu {
            list-style: none;
        }

        .menu a {
            display: flex;
            align-items: center;
            padding: 1rem 1.5rem;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            gap: 0.8rem;
        }

        .menu a:hover, .menu a.active {
            background: rgba(255,255,255,0.1);
            color: white;
            border-left: 4px solid #e63946;
        }

        .logout-btn {
            margin: 2rem 1.5rem;
            padding: 0.8rem;
            background: rgba(230,57,70,0.2);
            color: white;
            border: 2px solid #e63946;
            border-radius: 10px;
            cursor: pointer;
            width: calc(100% - 3rem);
            font-weight: bold;
        }

        .logout-btn:hover {
            background: #e63946;
        }

        .main-content {
            margin-left: 260px;
            flex: 1;
            padding: 2rem;
        }

        .top-bar {
            background: white;
            padding: 1.5rem 2rem;
            border-radius: 15px;
            margin-bottom: 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .top-bar h1 {
            color: #1e3c72;
            font-size: 1.8rem;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .card {
            background: white;
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .card.full {
            grid-column: 1 / -1;
        }

        .card.wide {
            grid-column: span 2;
        }

        .card h3 {
            color: #1e3c72;
            margin-bottom: 1rem;
            font-size: 1.2rem;
        }

        .muted {
            color: #666;
            line-height: 1.6;
        }

        .stat-box {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
            margin-bottom: 0.8rem;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1e3c72;
        }

        .alert-badge {
            display: inline-block;
            padding: 0.4rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
        }

        .alert-normal {
            background: #d4edda;
            color: #155724;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* AI Chatbot */
        .chat-fab {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #e63946, #c1121f);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(230,57,70,0.4);
            z-index: 1000;
            transition: transform 0.3s;
        }

        .chat-fab:hover {
            transform: scale(1.1);
        }

        .chat-fab span {
            font-size: 1.8rem;
        }

        .chat-window {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
            flex-direction: column;
            z-index: 999;
        }

        .chat-window.active {
            display: flex;
        }

        .chat-header {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-close {
            cursor: pointer;
            font-size: 1.5rem;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .chat-message {
            margin-bottom: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .chat-message.user {
            flex-direction: row-reverse;
        }

        .chat-bubble {
            max-width: 70%;
            padding: 0.8rem 1rem;
            border-radius: 15px;
            line-height: 1.4;
        }

        .chat-bubble.bot {
            background: #f0f0f0;
            color: #333;
        }

        .chat-bubble.user {
            background: #1e3c72;
            color: white;
        }

        .chat-input-area {
            padding: 1rem;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 0.5rem;
        }

        .chat-input-area input {
            flex: 1;
            padding: 0.8rem;
            border: 1px solid #e0e0e0;
            border-radius: 20px;
        }

        .chat-send-btn {
            padding: 0.8rem 1.5rem;
            background: #1e3c72;
            color: white;
            border: none;
            border-radius: 20px;
            cursor: pointer;
        }

        .prediction-panel {
            background: linear-gradient(135deg, #fff3cd, #ffeaa7);
            border-left: 4px solid #f39c12;
            padding: 1.5rem;
            border-radius: 10px;
            margin-top: 1rem;
        }

        .prediction-panel h4 {
            color: #856404;
            margin-bottom: 0.8rem;
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
            }

            .main-content {
                margin-left: 0;
            }

            .chat-window {
                width: calc(100% - 20px);
                right: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Login View -->
    <div id="loginView">
        <div class="login-container">
            <div class="login-header">
                <h1>ü¶∂ Diamon</h1>
                <p>Smart Footwear Platform</p>
            </div>
            <form onsubmit="handleLogin(); return false;">
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label>Password</label>
                    <input type="password" id="password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn-login">Login</button>
            </form>
            <div class="demo-accounts">
                <strong>Demo Accounts:</strong><br>
                Doctor: <code>diamondoctor@gmail.com</code><br>
                Patient: <code>diamonpatient@gmail.com</code><br>
                (Any password works)
            </div>
        </div>
    </div>

    <!-- Hospital Picker -->
    <div id="pickerView" class="hidden">
        <div class="picker-container">
            <div class="login-header">
                <h1>Select Hospital</h1>
                <p>Choose your treatment facility</p>
            </div>
            <select id="hospitalSelect">
                <option value="">-- Select Hospital --</option>
                <option value="LAUTECH Teaching Hospital">LAUTECH Teaching Hospital</option>
                <option value="University College Hospital, Ibadan">UCH, Ibadan</option>
                <option value="Lagos University Teaching Hospital">LUTH, Lagos</option>
                <option value="National Hospital, Abuja">National Hospital, Abuja</option>
            </select>
            <button class="btn-login" onclick="confirmHospital()">Continue</button>
            <button class="btn-login" style="background: #666; margin-top: 0.5rem;" onclick="goBackToLogin()">Back</button>
        </div>
    </div>

    <!-- Main App -->
    <div id="appView" class="hidden">
        <div class="sidebar">
            <div class="sidebar-header">
                <h2>ü¶∂ Diamon</h2>
                <span class="role-badge" id="roleTag">User</span>
            </div>
            <ul class="menu">
                <li><a href="#" data-tab="overview" class="active">üìä Overview</a></li>
                <li><a href="#" data-tab="realtime">üìà Real-time Monitor</a></li>
                <li id="patientsTab"><a href="#" data-tab="patients">üë• Patients</a></li>
                <li><a href="#" data-tab="calendar">üìÖ Calendar</a></li>
                <li><a href="#" data-tab="profile">üë§ Profile</a></li>
            </ul>
            <button class="logout-btn" onclick="logout()">Logout</button>
        </div>

        <div class="main-content">
            <div class="top-bar">
                <h1 id="whereText">Dashboard</h1>
            </div>
            <div id="contentArea"></div>
        </div>
    </div>

    <!-- AI Chatbot -->
    <div class="chat-fab" onclick="toggleChat()">
        <span>ü§ñ</span>
    </div>

    <div class="chat-window" id="chatWindow">
        <div class="chat-header">
            <h3>AI Health Assistant</h3>
            <span class="chat-close" onclick="toggleChat()">√ó</span>
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="chat-message">
                <div class="chat-bubble bot">
                    Hi! I'm your Diamon AI assistant. I can help you understand your foot health data, answer questions about diabetes care, and provide insights. How can I help you today?
                </div>
            </div>
        </div>
        <div class="chat-input-area">
            <input type="text" id="chatInput" placeholder="Type your question..." onkeypress="if(event.key==='Enter')sendMessage()">
            <button class="chat-send-btn" onclick="sendMessage()">Send</button>
        </div>
    </div>

    <script>
        const views = {
            login: document.getElementById('loginView'),
            picker: document.getElementById('pickerView'),
            app: document.getElementById('appView')
        };
        const contentArea = document.getElementById('contentArea');
        const whereText = document.getElementById('whereText');
        const roleTag = document.getElementById('roleTag');
        let CURRENT_ROLE = null;
        let CHARTS = {};
        let updateInterval;
        let temperatureHistory = {
            left: [30.45, 30.52, 30.48, 30.55, 30.50, 30.47, 30.53],
            right: [30.42, 30.49, 30.45, 30.51, 30.48, 30.44, 30.50]
        };

        function show(view) {
            Object.values(views).forEach(v => v.classList.add('hidden'));
            view.classList.remove('hidden');
        }

        function handleLogin() {
            const email = (document.getElementById('email').value || '').trim().toLowerCase();
            if (email === 'diamondoctor@gmail.com' || email === 'diamondoctor@gmail.com') {
                CURRENT_ROLE = 'doctor';
                roleTag.textContent = 'Doctor';
                initDoctorApp();
            } else if (email === 'diamonpatient@gmail.com') {
                CURRENT_ROLE = 'patient';
                roleTag.textContent = 'Patient';
                show(views.picker);
            } else {
                alert('Access denied. Please use demo accounts.');
            }
        }

        function goBackToLogin() {
            show(views.login);
        }

        function confirmHospital() {
            const sel = document.getElementById('hospitalSelect').value;
            if (!sel) return alert('Please select a hospital.');
            const docs = ['Dr. Tunde Olayemi', 'Dr. Aisha Bello', 'Dr. John Adebayo', 'Dr. Grace Ilori', 'Dr. Musa Abubakar'];
            const doc = docs[Math.floor(Math.random() * docs.length)];
            localStorage.setItem('hospital', sel);
            localStorage.setItem('assignedDoctor', doc);
            initPatientApp();
        }

        function initPatientApp() {
            show(views.app);
            whereText.textContent = 'Patient Dashboard';
            roleTag.textContent = 'Patient';
            renderPatientOverview();
            setupNav('patient');
        }

        function initDoctorApp() {
            show(views.app);
            whereText.textContent = 'Doctor Dashboard';
            roleTag.textContent = 'Doctor';
            renderDoctorOverview();
            setupNav('doctor');
        }

        function setupNav(role) {
            document.querySelectorAll('.menu a').forEach(a => {
                a.classList.remove('active');
                a.onclick = e => {
                    e.preventDefault();
                    document.querySelectorAll('.menu a').forEach(l => l.classList.remove('active'));
                    a.classList.add('active');
                    const tab = a.dataset.tab;
                    if (role === 'patient') {
                        if (tab === 'overview') renderPatientOverview();
                        else if (tab === 'calendar') renderCalendar();
                        else if (tab === 'realtime') renderRealtime();
                        else if (tab === 'profile') renderProfile(role);
                    } else {
                        if (tab === 'overview') renderDoctorOverview();
                        else if (tab === 'calendar') renderCalendar();
                        else if (tab === 'patients') renderDoctorPatients();
                        else if (tab === 'realtime') renderRealtime();
                        else if (tab === 'profile') renderProfile(role);
                    }
                }
            });
            document.getElementById('patientsTab').style.display = (role === 'doctor') ? 'flex' : 'none';
        }

        function logout() {
            clearInterval(updateInterval);
            location.reload();
        }

        // Temperature generation with smooth transitions
        function generateSmoothTemp(previous, min = 30.00, max = 31.00, maxChange = 0.08) {
            const change = (Math.random() - 0.5) * 2 * maxChange;
            let newTemp = previous + change;
            newTemp = Math.max(min, Math.min(max, newTemp));
            return parseFloat(newTemp.toFixed(2));
        }

        function updateTemperatureData() {
            const leftLast = temperatureHistory.left[temperatureHistory.left.length - 1];
            const rightLast = temperatureHistory.right[temperatureHistory.right.length - 1];
            
            temperatureHistory.left.push(generateSmoothTemp(leftLast));
            temperatureHistory.right.push(generateSmoothTemp(rightLast));
            
            if (temperatureHistory.left.length > 50) {
                temperatureHistory.left.shift();
                temperatureHistory.right.shift();
            }
        }

        function makeCharts(mode) {
            const labels = Array.from({length: temperatureHistory.left.length}, (_, i) => i + 1);

            function makeChart(id, type, data, options) {
                const el = document.getElementById(id);
                if (!el) return;
                if (CHARTS[id]) CHARTS[id].destroy();
                CHARTS[id] = new Chart(el.getContext('2d'), {type, data, options});
            }

            // Temperature comparison chart
            makeChart('tempChart', 'line', {
                labels,
                datasets: [
                    {
                        label: 'Left Shoe',
                        data: temperatureHistory.left,
                        borderColor: '#1e3c72',
                        backgroundColor: 'rgba(30, 60, 114, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2
                    },
                    {
                        label: 'Right Shoe',
                        data: temperatureHistory.right,
                        borderColor: '#e63946',
                        backgroundColor: 'rgba(230, 57, 70, 0.1)',
                        tension: 0.4,
                        fill: true,
                        borderWidth: 2
                    }
                ]
            }, {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {display: true, position: 'top'}
                },
                scales: {
                    y: {
                        min: 29.5,
                        max: 31.5,
                        ticks: {
                            callback: function(value) {
                                return value.toFixed(2) + '¬∞C';
                            }
                        }
                    }
                }
            });

            // Current temperature bar chart
            const currentLeft = temperatureHistory.left[temperatureHistory.left.length - 1];
            const currentRight = temperatureHistory.right[temperatureHistory.right.length - 1];
            
            makeChart('currentTempChart', 'bar', {
                labels: ['Left Shoe', 'Right Shoe'],
                datasets: [{
                    label: 'Current Temperature (¬∞C)',
                    data: [currentLeft, currentRight],
                    backgroundColor: ['#1e3c72', '#e63946']
                }]
            }, {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {legend: {display: false}},
                scales: {
                    y: {
                        min: 29.5,
                        max: 31.5,
                        ticks: {
                            callback: function(value) {
                                return value.toFixed(2) + '¬∞C';
                            }
                        }
                    }
                }
            });

            // Pressure balance
            const pressLeft = 48 + Math.random() * 4;
            const pressRight = 48 + Math.random() * 4;
            
            makeChart('pressChart', 'doughnut', {
                labels: ['Left Shoe', 'Right Shoe'],
                datasets: [{
                    data: [pressLeft, pressRight],
                    backgroundColor: ['#1e3c72', '#e63946']
                }]
            }, {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {display: true, position: 'bottom'}
                }
            });

            // Start live updates
            clearInterval(updateInterval);
            updateInterval = setInterval(() => {
                updateTemperatureData();
                if (CHARTS.tempChart) {
                    CHARTS.tempChart.data.labels = Array.from({length: temperatureHistory.left.length}, (_, i) => i + 1);
                    CHARTS.tempChart.data.datasets[0].data = temperatureHistory.left;
                    CHARTS.tempChart.data.datasets[1].data = temperatureHistory.right;
                    CHARTS.tempChart.update('none');
                }
                if (CHARTS.currentTempChart) {
                    const left = temperatureHistory.left[temperatureHistory.left.length - 1];
                    const right = temperatureHistory.right[temperatureHistory.right.length - 1];
                    CHARTS.currentTempChart.data.datasets[0].data = [left, right];
                    CHARTS.currentTempChart.update('none');
                    
                    // Update stat boxes
                    document.getElementById('leftTemp').textContent = left.toFixed(2) + '¬∞C';
                    document.getElementById('rightTemp').textContent = right.toFixed(2) + '¬∞C';
                    document.getElementById('tempDiff').textContent = Math.abs(left - right).toFixed(2) + '¬∞C';
                    
                    // Update alert status
                    const diff = Math.abs(left - right);
                    const alertEl = document.getElementById('alertStatus');
                    if (alertEl) {
                        if (diff > 2.2) {
                            alertEl.className = 'alert-badge alert-danger';
                            alertEl.textContent = '‚ö†Ô∏è Alert: High Temperature Difference';
                        } else if (diff > 1.5) {
                            alertEl.className = 'alert-badge alert-warning';
                            alertEl.textContent = '‚ö° Caution: Monitor Closely';
                        } else {
                            alertEl.className = 'alert-badge alert-normal';
                            alertEl.textContent = '‚úì Normal Range';
                        }
                    }
                }
            }, 3000);
        }

        function getAIPrediction() {
            const leftAvg = temperatureHistory.left.reduce((a, b) => a + b) / temperatureHistory.left.length;
            const rightAvg = temperatureHistory.right.reduce((a, b) => a + b) / temperatureHistory.right.length;
            const avgDiff = Math.abs(leftAvg - rightAvg);
            
            let risk = 'Low';
            let recommendation = 'Temperature readings are stable and within normal range. Continue daily monitoring.';
            let confidence = '92%';
            
            if (avgDiff > 1.8) {
                risk = 'High';
                recommendation = 'Significant temperature difference detected. Please contact your doctor immediately for examination. This may indicate early inflammation.';
                confidence = '87%';
            } else if (avgDiff > 1.2) {
                risk = 'Medium';
                recommendation = 'Slight temperature variation observed. Increase monitoring frequency and avoid prolonged standing. Schedule check-up within 48 hours.';
                confidence = '89%';
            }
            
            return {risk, recommendation, confidence, avgDiff: avgDiff.toFixed(2)};
        }

        function renderPatientOverview() {
            cleanupCharts();
            const hospital = localStorage.getItem('hospital') || '‚Äî';
            const doctor = localStorage.getItem('assignedDoctor') || '‚Äî';
            const prediction = getAIPrediction();
            
            contentArea.innerHTML = `
                <div class="grid">
                    <div class="card full">
                        <h3>üë§ Patient: Abdullahi</h3>
                        <div class="muted">Connected to <b>${doctor}</b> at <b>${hospital}</b></div>
                        <div style="margin-top: 1rem;">
                            <span id="alertStatus" class="alert-badge alert-normal">‚úì Normal Range</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Current Temperature</h3>
                        <div class="stat-box">
                            <span>Left Shoe üëü</span>
                            <span class="stat-value" id="leftTemp">30.50¬∞C</span>
                        </div>
                        <div class="stat-box">
                            <span>Right Shoe üëü</span>
                            <span class="stat-value" id="rightTemp">30.48¬∞C</span>
                        </div>
                        <div class="stat-box">
                            <span>Difference</span>
                            <span class="stat-value" id="tempDiff">0.02¬∞C</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Current Readings</h3>
                        <canvas id="currentTempChart" height="200"></canvas>
                    </div>
                    
                    <div class="card wide">
                        <h3>Temperature Trend (Both Feet)</h3>
                        <canvas id="tempChart" height="250"></canvas>
                    </div>
                    
                    <div class="card">
                        <h3>Pressure Balance</h3>
                        <canvas id="pressChart" height="200"></canvas>
                    </div>
                    
                    <div class="card full">
                        <h3>ü§ñ AI Prediction & Insights</h3>
                        <div class="prediction-panel">
                            <h4>Risk Assessment: ${prediction.risk}</h4>
                            <p><strong>Temperature Difference:</strong> ${prediction.avgDiff}¬∞C (Threshold: 2.2¬∞C)</p>
                            <p><strong>AI Confidence:</strong> ${prediction.confidence}</p>
                            <p style="margin-top: 0.8rem;"><strong>Recommendation:</strong> ${prediction.recommendation}</p>
                            <p style="margin-top: 0.8rem; font-size: 0.9em; color: #666;">
                                <em>AI analyzes your foot temperature patterns 24/7 to detect early signs of inflammation before ulcers develop.</em>
                            </p>
                        </div>
                    </div>
                </div>`;
            setTimeout(() => makeCharts('patient'), 100);
        }

        function renderDoctorOverview() {
            cleanupCharts();
            const prediction = getAIPrediction();
            
            contentArea.innerHTML = `
                <div class="grid">
                    <div class="card full">
                        <h3>üë®‚Äç‚öïÔ∏è Monitoring Patient: Abdullahi</h3>
                        <div class="muted">Real-time data from smart footwear system</div>
                        <div style="margin-top: 1rem;">
                            <span id="alertStatus" class="alert-badge alert-normal">‚úì Normal Range</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Live Temperature Readings</h3>
                        <div class="stat-box">
                            <span>Left Foot ü¶∂</span>
                            <span class="stat-value" id="leftTemp">30.50¬∞C</span>
                        </div>
                        <div class="stat-box">
                            <span>Right Foot ü¶∂</span>
                            <span class="stat-value" id="rightTemp">30.48¬∞C</span>
                        </div>
                        <div class="stat-box">
                            <span>Asymmetry</span>
                            <span class="stat-value" id="tempDiff">0.02¬∞C</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Current Status</h3>
                        <canvas id="currentTempChart" height="200"></canvas>
                    </div>
                    
                    <div class="card wide">
                        <h3>Temperature Monitoring (Last 5 Hours)</h3>
                        <canvas id="tempChart" height="250"></canvas>
                    </div>
                    
                    <div class="card">
                        <h3>Pressure Distribution</h3>
                        <canvas id="pressChart" height="200"></canvas>
                    </div>
                    
                    <div class="card full">
                        <h3>ü§ñ AI Clinical Decision Support</h3>
                        <div class="prediction-panel">
                            <h4>Risk Level: ${prediction.risk}</h4>
                            <p><strong>Average Temperature Asymmetry:</strong> ${prediction.avgDiff}¬∞C</p>
                            <p><strong>AI Model Confidence:</strong> ${prediction.confidence}</p>
                            <p style="margin-top: 0.8rem;"><strong>Clinical Recommendation:</strong> ${prediction.recommendation}</p>
                            <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 8px;">
                                <strong>Pattern Analysis (Last 5 Hours):</strong>
                                <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                                    <li>Temperature stability: Good</li>
                                    <li>Bilateral symmetry: ${prediction.avgDiff < 1.0 ? 'Excellent' : prediction.avgDiff < 1.5 ? 'Fair' : 'Poor'}</li>
                                    <li>Pressure distribution: Balanced</li>
                                    <li>Activity level: Normal</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>`;
            setTimeout(() => makeCharts('doctor'), 100);
        }

        function renderCalendar() {
            cleanupCharts();
            contentArea.innerHTML = `
                <div class="card full">
                    <h3>üìÖ Upcoming Appointments</h3>
                    <div style="margin-top: 1rem;">
                        <div class="stat-box">
                            <div>
                                <strong>Follow-up Check-up</strong><br>
                                <span class="muted">With ${localStorage.getItem('assignedDoctor') || 'Doctor'}</span>
                            </div>
                            <span style="color: #1e3c72; font-weight: bold;">Nov 8, 2025</span>
                        </div>
                        <div class="stat-box">
                            <div>
                                <strong>Foot Examination</strong><br>
                                <span class="muted">Routine screening for Abdullahi</span>
                            </div>
                            <span style="color: #1e3c72; font-weight: bold;">Nov 15, 2025</span>
                        </div>
                        <div class="stat-box">
                            <div>
                                <strong>Device Check</strong><br>
                                <span class="muted">Smart footwear calibration</span>
                            </div>
                            <span style="color: #1e3c72; font-weight: bold;">Nov 22, 2025</span>
                        </div>
                    </div>
                </div>`;
        }

        function renderDoctorPatients() {
            cleanupCharts();
            const prediction = getAIPrediction();
            contentArea.innerHTML = `
                <div class="card full">
                    <h3>üë• My Patients</h3>
                    <div style="margin-top: 1rem;">
                        <div class="stat-box">
                            <div>
                                <strong>Abdullahi</strong><br>
                                <span class="muted">Active monitoring ‚Ä¢ Last reading: 2 min ago</span>
                            </div>
                            <span class="alert-badge ${prediction.avgDiff > 1.5 ? 'alert-warning' : 'alert-normal'}">
                                ${prediction.avgDiff > 1.5 ? '‚ö° Monitor' : '‚úì Stable'}
                            </span>
                        </div>
                        <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 10px;">
                            <p><strong>Current Status:</strong></p>
                            <p class="muted" style="margin-top: 0.5rem;">
                                Temperature: Left ${temperatureHistory.left[temperatureHistory.left.length - 1].toFixed(2)}¬∞C, 
                                Right ${temperatureHistory.right[temperatureHistory.right.length - 1].toFixed(2)}¬∞C<br>
                                Difference: ${prediction.avgDiff}¬∞C | Risk: ${prediction.risk}
                            </p>
                        </div>
                    </div>
                </div>`;
        }

        function renderRealtime() {
            cleanupCharts();
            contentArea.innerHTML = `
                <div class="grid">
                    <div class="card full">
                        <h3>üìà Real-Time Temperature Monitoring - Abdullahi</h3>
                        <div class="muted">Live streaming data from smart footwear sensors</div>
                        <div style="margin-top: 1rem;">
                            <span id="alertStatus" class="alert-badge alert-normal">‚úì Normal Range</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Live Readings</h3>
                        <div class="stat-box">
                            <span>Left Foot ü¶∂</span>
                            <span class="stat-value" id="leftTemp">30.50¬∞C</span>
                        </div>
                        <div class="stat-box">
                            <span>Right Foot ü¶∂</span>
                            <span class="stat-value" id="rightTemp">30.48¬∞C</span>
                        </div>
                        <div class="stat-box">
                            <span>Difference</span>
                            <span class="stat-value" id="tempDiff">0.02¬∞C</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h3>Current Temperature</h3>
                        <canvas id="currentTempChart" height="200"></canvas>
                    </div>
                    
                    <div class="card full">
                        <h3>Temperature Trend (Continuous Stream)</h3>
                        <canvas id="tempChart" height="300"></canvas>
                    </div>
                </div>`;
            setTimeout(() => makeCharts('realtime'), 100);
        }

        function renderProfile(role) {
            cleanupCharts();
            const hospital = localStorage.getItem('hospital') || 'Not assigned';
            const doctor = localStorage.getItem('assignedDoctor') || 'Not assigned';
            
            if (role === 'patient') {
                contentArea.innerHTML = `
                    <div class="card full">
                        <h3>üë§ Patient Profile - Abdullahi</h3>
                        <div style="margin-top: 1.5rem;">
                            <div class="stat-box">
                                <span><strong>Full Name:</strong></span>
                                <span>Abdullahi</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>Patient ID:</strong></span>
                                <span>DM-2024-001</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>Hospital:</strong></span>
                                <span>${hospital}</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>Assigned Doctor:</strong></span>
                                <span>${doctor}</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>Device Status:</strong></span>
                                <span style="color: #22c55e;">üü¢ Connected</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>Monitoring Since:</strong></span>
                                <span>October 2024</span>
                            </div>
                        </div>
                    </div>`;
            } else {
                contentArea.innerHTML = `
                    <div class="card full">
                        <h3>üë®‚Äç‚öïÔ∏è Doctor Profile</h3>
                        <div style="margin-top: 1.5rem;">
                            <div class="stat-box">
                                <span><strong>Name:</strong></span>
                                <span>${doctor || 'Dr. Medical Professional'}</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>Specialization:</strong></span>
                                <span>Endocrinology & Diabetes Care</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>Hospital:</strong></span>
                                <span>${hospital}</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>Active Patients:</strong></span>
                                <span>1 (Abdullahi)</span>
                            </div>
                            <div class="stat-box">
                                <span><strong>License Number:</strong></span>
                                <span>MD-NG-2024-1234</span>
                            </div>
                        </div>
                    </div>`;
            }
        }

        function cleanupCharts() {
            Object.values(CHARTS).forEach(c => {
                try { c.destroy(); } catch (e) {}
            });
            CHARTS = {};
        }

        // AI Chatbot Functions
        function toggleChat() {
            const chatWindow = document.getElementById('chatWindow');
            chatWindow.classList.toggle('active');
        }

        function sendMessage() {
            const input = document.getElementById('chatInput');
            const message = input.value.trim();
            if (!message) return;

            // Add user message
            addChatMessage(message, 'user');
            input.value = '';

            // Simulate AI response
            setTimeout(() => {
                const response = getAIResponse(message);
                addChatMessage(response, 'bot');
            }, 1000);
        }

        function addChatMessage(text, sender) {
            const messagesDiv = document.getElementById('chatMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `chat-message ${sender}`;
            
            const bubble = document.createElement('div');
            bubble.className = `chat-bubble ${sender}`;
            bubble.textContent = text;
            
            messageDiv.appendChild(bubble);
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function getAIResponse(message) {
            const msg = message.toLowerCase();
            
            // Smart responses based on context
            if (msg.includes('temperature') || msg.includes('temp')) {
                const left = temperatureHistory.left[temperatureHistory.left.length - 1];
                const right = temperatureHistory.right[temperatureHistory.right.length - 1];
                const diff = Math.abs(left - right);
                return `Current temperature readings for Abdullahi: Left foot ${left.toFixed(2)}¬∞C, Right foot ${right.toFixed(2)}¬∞C. Temperature difference is ${diff.toFixed(2)}¬∞C, which is ${diff > 2.2 ? 'above' : 'within'} the safety threshold of 2.2¬∞C.`;
            }
            
            if (msg.includes('risk') || msg.includes('danger')) {
                const prediction = getAIPrediction();
                return `Based on current data analysis, Abdullahi's risk level is: ${prediction.risk}. ${prediction.recommendation}`;
            }
            
            if (msg.includes('ulcer') || msg.includes('foot ulcer')) {
                return `Diabetic foot ulcers develop when inflammation goes undetected. Our system monitors temperature differences between feet - a difference greater than 2.2¬∞C for 5+ hours indicates high risk. Early detection allows intervention before ulcers form, reducing amputation risk by up to 85%.`;
            }
            
            if (msg.includes('alert') || msg.includes('notification')) {
                return `You'll receive instant alerts if: 1) Temperature difference exceeds 2.2¬∞C between feet, 2) Sustained elevation for 5+ hours, 3) Abnormal pressure patterns detected. Both you and your doctor are notified simultaneously for immediate action.`;
            }
            
            if (msg.includes('shoe') || msg.includes('device')) {
                return `The Diamon smart footwear system uses infrared sensors at three key pressure points: Hallux (big toe), 1st Metatarsal, and heel. Sensors measure temperature every few seconds and transmit data securely to the cloud. Battery lasts 12+ hours per charge.`;
            }
            
            if (msg.includes('doctor') || msg.includes('appointment')) {
                const doctor = localStorage.getItem('assignedDoctor') || 'your doctor';
                return `Abdullahi is currently monitored by ${doctor}. Next appointment is scheduled for November 8, 2025. Your doctor can view all data in real-time and will contact you if any concerns arise.`;
            }
            
            if (msg.includes('prevent') || msg.includes('care')) {
                return `To prevent complications: 1) Wear your Diamon footwear daily for continuous monitoring, 2) Inspect feet daily for cuts or changes, 3) Keep feet clean and moisturized, 4) Control blood sugar levels, 5) Attend all scheduled check-ups, 6) Report any unusual pain or numbness immediately.`;
            }
            
            if (msg.includes('how') && (msg.includes('work') || msg.includes('works'))) {
                return `Diamon works by continuously monitoring foot temperature at critical pressure points. When inflammation begins (pre-ulcer stage), temperature increases. By detecting temperature differences of 2.2¬∞C or more between corresponding points on each foot, we catch problems before they become ulcers. This gives doctors time to intervene with offloading, antibiotics, or other treatments.`;
            }
            
            if (msg.includes('hi') || msg.includes('hello') || msg.includes('hey')) {
                return `Hello! I'm here to help you understand Abdullahi's foot health data and answer questions about diabetes foot care. You can ask me about temperature readings, risk assessment, device usage, or general diabetes care tips. What would you like to know?`;
            }
            
            if (msg.includes('thank')) {
                return `You're welcome! I'm here 24/7 to help with any questions about Abdullahi's foot health monitoring. Feel free to ask anything!`;
            }
            
            // Default response
            return `I understand you're asking about "${message}". As Abdullahi's AI health assistant, I can help with: temperature readings, risk assessment, device information, prevention tips, and appointment scheduling. Could you please be more specific about what you'd like to know?`;
        }

        // Initialize smooth temperature animation on load
        setInterval(() => {
            if (CHARTS.tempChart) {
                updateTemperatureData();
            }
        }, 3000);
    </script>
</body>
</html>
