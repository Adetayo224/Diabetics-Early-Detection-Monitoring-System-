#include <WiFi.h>
#include <WebServer.h>

// WiFi Credentials
const char* ssid = "Samfred";
const char* password = "samfred224";

// Sensor Pins
const int SENSOR1_PIN = 0;  // GPIO0
const int SENSOR2_PIN = 1;  // GPIO1

// Web Server
WebServer server(80);

// Temperature readings
float temp1 = 0.0;
float temp2 = 0.0;
unsigned long lastReadTime = 0;

void setup() {
  Serial.begin(115200);
  delay(1000);
  
  Serial.println("\n=============================");
  Serial.println("Dual Sensor Monitor");
  Serial.println("=============================\n");
  
  // Configure ADC
  analogReadResolution(12);
  analogSetAttenuation(ADC_11db);
  
  // Connect to WiFi
  Serial.print("Connecting to: ");
  Serial.println(ssid);
  WiFi.begin(ssid, password);
  
  int attempts = 0;
  while (WiFi.status() != WL_CONNECTED && attempts < 30) {
    delay(500);
    Serial.print(".");
    attempts++;
  }
  
  if (WiFi.status() == WL_CONNECTED) {
    Serial.println("\n\n‚úì WiFi Connected!");
    Serial.print("IP Address: ");
    Serial.println(WiFi.localIP());
    Serial.println("\nOpen in browser:");
    Serial.print("http://");
    Serial.println(WiFi.localIP());
  } else {
    Serial.println("\n\n‚úó Connection Failed!");
  }
  
  // Setup routes
  server.on("/", handleRoot);
  server.on("/data", handleData);
  server.begin();
  
  Serial.println("\n=============================\n");
}

void loop() {
  server.handleClient();
  
  // Read sensors every 2 seconds
  if (millis() - lastReadTime >= 2000) {
    readSensors();
    lastReadTime = millis();
  }
}

void readSensors() {
  // Read Sensor 1 (GPIO0)
  int raw1 = analogRead(SENSOR1_PIN);
  float voltage1 = (raw1 * 3.3) / 4096.0;
  temp1 = voltage1 * 100.0;
  
  // Read Sensor 2 (GPIO1)
  int raw2 = analogRead(SENSOR2_PIN);
  float voltage2 = (raw2 * 3.3) / 4096.0;
  temp2 = voltage2 * 100.0;
  
  // Display on Serial
  Serial.print("Sensor 1: ");
  Serial.print(temp1, 1);
  Serial.print("¬∞C  |  Sensor 2: ");
  Serial.print(temp2, 1);
  Serial.println("¬∞C");
}

void handleRoot() {
  String html = "<!DOCTYPE html><html><head>";
  html += "<meta name='viewport' content='width=device-width, initial-scale=1.0'>";
  html += "<meta charset='UTF-8'>";
  html += "<title>Temperature Monitor</title>";
  html += "<style>";
  html += "*{margin:0;padding:0;box-sizing:border-box}";
  html += "body{";
  html += "font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;";
  html += "background:linear-gradient(135deg,#d4a574 0%,#8b6914 100%);";
  html += "min-height:100vh;padding:20px;color:#4a3319}";
  html += ".container{max-width:900px;margin:0 auto}";
  html += "header{";
  html += "background:linear-gradient(135deg,#f5deb3,#daa520);";
  html += "padding:30px;border-radius:20px;";
  html += "box-shadow:0 10px 40px rgba(0,0,0,0.3);";
  html += "text-align:center;margin-bottom:30px;";
  html += "border:3px solid #8b6914}";
  html += "h1{font-size:2.5em;color:#4a3319;text-shadow:2px 2px 4px rgba(255,255,255,0.5);margin-bottom:10px}";
  html += ".subtitle{color:#6b4423;font-size:1.1em;font-weight:500}";
  html += ".sensor-grid{";
  html += "display:grid;grid-template-columns:repeat(auto-fit,minmax(350px,1fr));";
  html += "gap:25px;margin-top:20px}";
  html += ".sensor-card{";
  html += "background:linear-gradient(135deg,#fff8dc,#f5deb3);";
  html += "padding:35px;border-radius:20px;";
  html += "box-shadow:0 10px 30px rgba(0,0,0,0.25);";
  html += "border:3px solid #daa520;";
  html += "transition:transform 0.3s ease}";
  html += ".sensor-card:hover{transform:translateY(-5px)}";
  html += ".sensor-title{";
  html += "font-size:1.5em;color:#8b6914;";
  html += "margin-bottom:20px;text-align:center;";
  html += "font-weight:bold;";
  html += "padding-bottom:15px;";
  html += "border-bottom:3px solid #daa520}";
  html += ".temp-display{";
  html += "font-size:4.5em;font-weight:bold;";
  html += "color:#d4a574;text-align:center;";
  html += "text-shadow:3px 3px 6px rgba(0,0,0,0.2);";
  html += "margin:25px 0;";
  html += "background:linear-gradient(135deg,#8b6914,#d4a574);";
  html += "-webkit-background-clip:text;";
  html += "-webkit-text-fill-color:transparent;";
  html += "background-clip:text}";
  html += ".unit{font-size:0.4em;color:#8b6914}";
  html += ".status-box{";
  html += "background:#fff;padding:15px;";
  html += "border-radius:10px;text-align:center;";
  html += "border:2px solid #daa520;";
  html += "color:#6b4423;font-weight:600}";
  html += ".icon{font-size:2em;margin-bottom:10px}";
  html += ".update-time{";
  html += "text-align:center;margin-top:20px;";
  html += "color:#f5deb3;font-size:0.9em;";
  html += "padding:10px;background:rgba(0,0,0,0.2);";
  html += "border-radius:10px}";
  html += "@keyframes fadeIn{from{opacity:0}to{opacity:1}}";
  html += ".sensor-card{animation:fadeIn 0.6s ease-in}";
  html += "@media(max-width:768px){";
  html += "h1{font-size:1.8em}";
  html += ".temp-display{font-size:3em}";
  html += ".sensor-grid{grid-template-columns:1fr}}";
  html += "</style>";
  html += "<script>";
  html += "function updateData(){";
  html += "fetch('/data').then(r=>r.text()).then(data=>{";
  html += "let temps=data.split(',');";
  html += "document.getElementById('temp1').innerHTML=temps[0]+'<span class=\"unit\">¬∞C</span>';";
  html += "document.getElementById('temp2').innerHTML=temps[1]+'<span class=\"unit\">¬∞C</span>';";
  html += "let now=new Date();";
  html += "document.getElementById('time').textContent='Last updated: '+now.toLocaleTimeString();";
  html += "}).catch(err=>console.error('Error:',err));}";
  html += "setInterval(updateData,2000);";
  html += "updateData();";
  html += "</script>";
  html += "</head><body>";
  html += "<div class='container'>";
  
  // Header
  html += "<header>";
  html += "<h1>ü¶∂ Temperature Monitoring System</h1>";
  html += "<p class='subtitle'>Dual Sensor Real-Time Monitoring</p>";
  html += "</header>";
  
  // Sensor Cards
  html += "<div class='sensor-grid'>";
  
  // Sensor 1
  html += "<div class='sensor-card'>";
  html += "<div class='icon'>üå°Ô∏è</div>";
  html += "<div class='sensor-title'>Sensor 1 (GPIO0)</div>";
  html += "<div class='temp-display' id='temp1'>--</div>";
  html += "<div class='status-box'>Monitoring Active</div>";
  html += "</div>";
  
  // Sensor 2
  html += "<div class='sensor-card'>";
  html += "<div class='icon'>üå°Ô∏è</div>";
  html += "<div class='sensor-title'>Sensor 2 (GPIO1)</div>";
  html += "<div class='temp-display' id='temp2'>--</div>";
  html += "<div class='status-box'>Monitoring Active</div>";
  html += "</div>";
  
  html += "</div>";
  
  // Update time
  html += "<div class='update-time' id='time'>Loading...</div>";
  
  html += "</div>";
  html += "</body></html>";
  
  server.send(200, "text/html", html);
}

void handleData() {
  String data = String(temp1, 1) + "," + String(temp2, 1);
  server.send(200, "text/plain", data);
}
